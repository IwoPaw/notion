<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Delayed Page Audio Player</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.container {
    background: #1e1e1e;
    padding: 25px;
    border-radius: 10px;
    width: 400px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
}
input, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
    border: none;
}
input {
    background: #2c2c2c;
    color: white;
}
button {
    background: #4CAF50;
    color: white;
    font-weight: bold;
    cursor: pointer;
}
button:hover {
    background: #45a049;
}
#status {
    margin-top: 15px;
}
</style>
</head>
<body>

<div class="container">
    <h2>Delayed Page Audio Player</h2>

    <label>Page URL:</label>
    <input type="text" id="pageUrl" placeholder="https://example.com/page">

    <label>Delay (seconds):</label>
    <input type="number" id="delay" placeholder="30">

    <button onclick="start()">Start</button>

    <div id="status"></div>
    <audio id="player"></audio>
</div>

<script>
let countdownInterval;

async function extractAudioUrl(pageUrl) {
    try {
        const response = await fetch(pageUrl);
        const text = await response.text();

        // Find first .m4a link in page source
        const match = text.match(/https:\/\/[^"]+\.m4a/);
        if (match) {
            return match[0];
        }
        return null;
    } catch (err) {
        return null;
    }
}

async function start() {
    const pageUrl = document.getElementById("pageUrl").value;
    const delaySeconds = parseInt(document.getElementById("delay").value);
    const status = document.getElementById("status");

    if (!pageUrl || !delaySeconds || delaySeconds <= 0) {
        alert("Enter valid URL and delay.");
        return;
    }

    status.innerText = "Extracting audio link...";

    const audioUrl = await extractAudioUrl(pageUrl);

    if (!audioUrl) {
        status.innerText = "Failed to extract audio (likely blocked by browser security).";
        return;
    }

    const player = document.getElementById("player");
    player.src = audioUrl;

    let timeLeft = delaySeconds;
    status.innerText = `Playing in ${timeLeft} seconds...`;

    clearInterval(countdownInterval);

    countdownInterval = setInterval(() => {
        timeLeft--;
        status.innerText = `Playing in ${timeLeft} seconds...`;

        if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            status.innerText = "Playing now!";
            player.play().catch(() => {
                alert("Click anywhere on the page first, then try again.");
            });
        }
    }, 1000);
}
</script>

</body>
</html>
